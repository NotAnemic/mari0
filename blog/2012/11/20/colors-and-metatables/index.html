
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Colors and Metatables - Getting The Gist</title>
  <meta name="author" content="Tanner Rogalsky">

  
  <meta name="description" content="Love2D, like any good framework built for Lua, keeps it simple and to the point. So there are some things you can either implement yourself or use a &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://tannerrogalsky.github.com/blog/2012/11/20/colors-and-metatables/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="Getting The Gist" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-30607414-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Getting The Gist</a></h1>
  
    <h2>Some butter-makers just want to see the world churn.</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:tannerrogalsky.github.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul role=main-navigation>
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
  <li><a href="/about">About</a></li>
</ul>


</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Colors and Metatables</h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-11-20T15:06:00-05:00" pubdate data-updated="true">Nov 20<span>th</span>, 2012</time>
        
      </p>
    
  </header>


<div class="entry-content"><p><a href="https://love2d.org/">Love2D</a>, like any good framework built for Lua, keeps it simple and to the point. So there are some things you can either implement yourself or use a third party library. If you&#8217;re down with the latter, you might be interested in my color index built with metatables.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
</pre></td><td class='code'><pre><code class='lua'><span class='line'><span class="kd">local</span> <span class="n">COLORS</span>
</span><span class='line'><span class="k">do</span>
</span><span class='line'>  <span class="kd">local</span> <span class="n">rgb</span> <span class="o">=</span> <span class="k">function</span><span class="p">(</span><span class="n">color</span><span class="p">)</span> <span class="k">return</span> <span class="n">color</span><span class="p">.</span><span class="n">r</span><span class="p">,</span> <span class="n">color</span><span class="p">.</span><span class="n">g</span><span class="p">,</span> <span class="n">color</span><span class="p">.</span><span class="n">b</span> <span class="k">end</span>
</span><span class='line'>  <span class="kd">local</span> <span class="n">rgba</span> <span class="o">=</span> <span class="k">function</span><span class="p">(</span><span class="n">color</span><span class="p">)</span> <span class="k">return</span> <span class="n">color</span><span class="p">.</span><span class="n">r</span><span class="p">,</span> <span class="n">color</span><span class="p">.</span><span class="n">g</span><span class="p">,</span> <span class="n">color</span><span class="p">.</span><span class="n">b</span><span class="p">,</span> <span class="n">color</span><span class="p">.</span><span class="n">a</span> <span class="k">end</span>
</span><span class='line'>  <span class="n">COLORS</span> <span class="o">=</span> <span class="nb">setmetatable</span><span class="p">({},</span>
</span><span class='line'>    <span class="p">{</span><span class="n">__newindex</span> <span class="o">=</span> <span class="k">function</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
</span><span class='line'>      <span class="n">v</span><span class="p">.</span><span class="n">rgb</span> <span class="o">=</span> <span class="n">rgb</span>
</span><span class='line'>      <span class="n">v</span><span class="p">.</span><span class="n">rgba</span> <span class="o">=</span> <span class="n">rgba</span>
</span><span class='line'>      <span class="nb">rawset</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
</span><span class='line'>    <span class="k">end</span><span class="p">,</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">__index</span> <span class="o">=</span> <span class="k">function</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
</span><span class='line'>      <span class="k">return</span> <span class="nb">rawget</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">k</span><span class="p">:</span><span class="n">upper</span><span class="p">())</span>
</span><span class='line'>    <span class="k">end</span><span class="p">})</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'><span class="n">COLORS</span><span class="p">.</span><span class="n">RED</span> <span class="o">=</span>    <span class="p">{</span><span class="n">r</span> <span class="o">=</span> <span class="mi">255</span><span class="p">,</span> <span class="n">g</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>   <span class="n">b</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>   <span class="n">a</span> <span class="o">=</span> <span class="mi">255</span><span class="p">}</span>
</span><span class='line'><span class="n">COLORS</span><span class="p">.</span><span class="n">GREEN</span> <span class="o">=</span>  <span class="p">{</span><span class="n">r</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>   <span class="n">g</span> <span class="o">=</span> <span class="mi">255</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>   <span class="n">a</span> <span class="o">=</span> <span class="mi">255</span><span class="p">}</span>
</span><span class='line'><span class="n">COLORS</span><span class="p">.</span><span class="n">BLUE</span> <span class="o">=</span>   <span class="p">{</span><span class="n">r</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>   <span class="n">g</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>   <span class="n">b</span> <span class="o">=</span> <span class="mi">255</span><span class="p">,</span> <span class="n">a</span> <span class="o">=</span> <span class="mi">255</span><span class="p">}</span>
</span><span class='line'><span class="n">COLORS</span><span class="p">.</span><span class="n">WHITE</span> <span class="o">=</span>  <span class="p">{</span><span class="n">r</span> <span class="o">=</span> <span class="mi">255</span><span class="p">,</span> <span class="n">g</span> <span class="o">=</span> <span class="mi">255</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="mi">255</span><span class="p">,</span> <span class="n">a</span> <span class="o">=</span> <span class="mi">255</span><span class="p">}</span>
</span><span class='line'><span class="n">COLORS</span><span class="p">.</span><span class="n">BLACK</span> <span class="o">=</span>  <span class="p">{</span><span class="n">r</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>   <span class="n">g</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>   <span class="n">b</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>   <span class="n">a</span> <span class="o">=</span> <span class="mi">255</span><span class="p">}</span>
</span><span class='line'><span class="n">COLORS</span><span class="p">.</span><span class="n">YELLOW</span> <span class="o">=</span> <span class="p">{</span><span class="n">r</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>   <span class="n">g</span> <span class="o">=</span> <span class="mi">255</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="mi">255</span><span class="p">,</span> <span class="n">a</span> <span class="o">=</span> <span class="mi">255</span><span class="p">}</span>
</span><span class='line'><span class="n">COLORS</span><span class="p">.</span><span class="n">PURPLE</span> <span class="o">=</span> <span class="p">{</span><span class="n">r</span> <span class="o">=</span> <span class="mi">255</span><span class="p">,</span> <span class="n">g</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>   <span class="n">b</span> <span class="o">=</span> <span class="mi">255</span><span class="p">,</span> <span class="n">a</span> <span class="o">=</span> <span class="mi">255</span><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Usage is like so:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='lua'><span class='line'><span class="n">love</span><span class="p">.</span><span class="n">graphics</span><span class="p">.</span><span class="n">setColor</span><span class="p">(</span><span class="n">COLORS</span><span class="p">.</span><span class="n">GREEN</span><span class="p">:</span><span class="n">rgb</span><span class="p">())</span>
</span><span class='line'><span class="n">love</span><span class="p">.</span><span class="n">graphics</span><span class="p">.</span><span class="n">setColor</span><span class="p">(</span><span class="n">COLORS</span><span class="p">.</span><span class="n">GREEN</span><span class="p">:</span><span class="n">rgba</span><span class="p">())</span>
</span></code></pre></td></tr></table></div></figure>


<p>You can also use either upper or lower cases (or a combination) to specify color names (i.e. <code>COLORS.GREEN:rgb == COLORS.green:rgb</code>). A full explanation of the code follows. It&#8217;s mostly an explanation of Lua metatables.<!--more--></p>

<p>Firstly, we declare an empty <code>COLORS</code> variable. This is because we&#8217;re going to be sandboxing to avoid unnecessary anonymous function creation and we still want to be able to access our colors outside of the sandbox. Then we start our <code>do</code> block and declare some helper functions. We can do this because they will be local to the scope of the do block and will be discarded after we exit the block on line 15.</p>

<p>On the fifth line is where the fun starts. We&#8217;re going to assign a table to the <code>COLORS</code> variable but, before we do that, we&#8217;re going to modify how the table reacts to certain things by applying a metatable to it. The <code>__newindex</code> function defines what a table does when you put something new in it. The <code>__index</code> function defines what a table does when you try to access a key that hasn&#8217;t been assigned.</p>

<p>The <code>__newindex</code> function gets passed three arguments: the table itself, the key being assigned and the value that we&#8217;re trying to assign to the key. In this case, the key is going to be a color name and the value is going to be a table of red, green, blue, and alpha values that correspond to that color. We&#8217;re going to add the two helper functions that we defined earlier to the rgba table. Those helpers are now, in the context of the color table, going to let us pull the values out of that table in a way that makes sense and can be used by Love2D. Line 9 actually sets the table of color values into the color map; that is to say that it sets the value, ignoring the <code>__newindex</code> function.</p>

<p>The <code>__index</code> function gets passed two arguments: the table and the key being assigned. Remember, this only gets called when we&#8217;re trying to access a key that hasn&#8217;t been defined. In that case, we want to convert the color name to all caps and try again because we either used lowercase letters in the color name or there&#8217;s an error in the code.</p>

<p>The rest of the snippet is just setting up some colors. Each time we set up a new color, the <code>__newindex</code> function runs, doing additional setup to the rgb map. And that&#8217;s it!</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Tanner Rogalsky</span></span>

      








  


<time datetime="2012-11-20T15:06:00-05:00" pubdate data-updated="true">Nov 20<span>th</span>, 2012</time>
      


    </p>
    
      <div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://tannerrogalsky.github.com/blog/2012/11/20/colors-and-metatables/" data-via="WuTangTan" data-counturl="http://tannerrogalsky.github.com/blog/2012/11/20/colors-and-metatables/" >Tweet</a>
  
  
  <div class="g-plusone" data-size="medium"></div>
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2012/09/19/favourite-lua-libraries/" title="Previous Post: My Favourite Lua Libraries">&laquo; My Favourite Lua Libraries</a>
      
      
        <a class="basic-alignment right" href="/blog/2013/02/11/electric-boobaloo/" title="Next Post: TGGJ13 - Electric Boobaloo">TGGJ13 - Electric Boobaloo &raquo;</a>
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2013/02/11/electric-boobaloo/">TGGJ13 - Electric Boobaloo</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/11/20/colors-and-metatables/">Colors and Metatables</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/09/19/favourite-lua-libraries/">My Favourite Lua Libraries</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/05/15/tojam-2012-gridphreak/">TOJam 2012 - [GRIDPHREAK]</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/04/06/control-maps-in-love2d/">Control Maps in Love2D</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating...</li>
  </ul>
  
  <a href="https://github.com/TannerRogalsky">@TannerRogalsky</a> on GitHub
  
  <script type="text/javascript">
    $.domReady(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'TannerRogalsky',
            count: 5,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>


<section>
  <h1>Latest Tweets</h1>
  <ul id="tweets">
    <li class="loading">Status updating...</li>
  </ul>
  <script type="text/javascript">
    $.domReady(function(){
      getTwitterFeed("WuTangTan", 4, false);
    });
  </script>
  <script src="/javascripts/twitter.js" type="text/javascript"> </script>
  
    <p>Follow <a href="http://twitter.com/WuTangTan">@WuTangTan</a></p>
  
</section>





  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2013 - Tanner Rogalsky -
  PGP Fingerprint: 7c:6a:fd:94:ed:44:95:e9:af:8f:8b:17:a4:ad:65:57 -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'gettingthegist';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://tannerrogalsky.github.com/blog/2012/11/20/colors-and-metatables/';
        var disqus_url = 'http://tannerrogalsky.github.com/blog/2012/11/20/colors-and-metatables/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>





  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
